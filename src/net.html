<html>
    <head>
        <meta charset="utf-8">
        <title>Net Spliiter</title>
        <script src='https://code.jquery.com/jquery-2.1.3.min.js'></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r71/three.min.js"></script>
        <link rel="stylesheet" type="text/css" href="style/main.css">
        <link rel="stylesheet" type="text/css" href="style/svg.css">
        <link rel="stylesheet" type="text/css" href="style/jquery.svg.css">
    </head>
    <body>
        <div id="canvas">            
        </div>
        <script src='js/extension.js'></script>
        <script src='js/ori.js'></script>
        <script src='js/net-spliiter.js'></script>
        <script src="js/svg/jquery.svg.min.js"></script>
        <script>
            $("#canvas").svg();
            var svg = $('#canvas').svg('get');

            var origami = new Origami.Model();

            function draw()
            {
                // clear exisiting drawing
                svg.clear(true);
                origami.drawSVG(svg);
                var bbox = origami.geometry.boundingBox;
                var width = bbox.max.x - bbox.min.x;
                var height = bbox.max.z - bbox.min.z;
                var viewBox = "{0} {1} {2} {3}".format(bbox.min.x*1.1, bbox.min.z*1.1, width*1.2, height*1.2);
                svg.configure({viewBox: viewBox, width: 400}, true);
            }

            origami.load('models/star-024_18811.ori.json', null, function() {
                draw();                
            });

            $("html").on("dragover", function(event) {
                event.preventDefault();  
                event.stopPropagation();
                //$(this).addClass('dragging');
            });

            $("html").on("dragleave", function(event) {
                event.preventDefault();  
                event.stopPropagation();
                //$(this).removeClass('dragging');
            });

            $("html").on("drop", function(event) {
                event.preventDefault();  
                event.stopPropagation();
                var files = event.originalEvent.dataTransfer.files;
                if(!files) return;

                // only read the first file
                var file = files[0];
                if(file.name.indexOf('.json')==-1) return;
                var reader = new FileReader();

                reader.onload = function(e) {
                    var text = reader.result;
                    var obj = $.parseJSON(text);
                    origami.build(obj);
                    draw();
                }

                reader.readAsText(file, 'UTF-8');
            });
        </script>    
    </body>
</html>